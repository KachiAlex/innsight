generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Tenant {
  id                    String                        @id @default(uuid())
  name                  String
  slug                  String                        @unique
  email                 String
  phone                 String?
  address               String?
  branding              Json?
  taxSettings           Json?
  subscriptionStatus    String                        @default("active")
  createdAt             DateTime                      @default(now())
  updatedAt             DateTime                      @updatedAt
  accountabilityReports AccountabilityReport[]
  alerts                Alert[]
  analyticsMetrics      AnalyticsMetric[]
  audits                Audit[]
  depositPayments       DepositPayment[]
  depositPolicies       DepositPolicy[]
  folios                Folio[]
  groupBookingHalls     GroupBookingHallReservation[]
  groupBookings         GroupBooking[]
  guestBehaviors        GuestBehavior[]
  guestRequests         GuestRequest[]
  guests                Guest[]
  guestAccounts         GuestAccount[]
  housekeepingTasks     HousekeepingTask[]
  inventoryAnalytics    InventoryAnalytics[]
  iotEvents             IoTEvent[]
  iotGateways           IoTGateway[]
  lostItems             LostItem[]
  loyaltyProgram        LoyaltyProgram?
  maintenanceTickets    MaintenanceTicket[]
  meetingHalls          MeetingHall[]
  menuCategories        MenuCategory[]
  menuItems             MenuItem[]
  nightAudits           NightAudit[]
  overbookingAlerts     OverbookingAlert[]
  overbookingSettings   OverbookingSetting[]
  payments              Payment[]
  predictiveModels      PredictiveModel[]
  RatePlan              RatePlan[]
  reservations          Reservation[]
  roomBlocks            RoomBlock[]
  roomCategories        RoomCategory[]
  roomLogs              RoomLog[]
  roomServiceOrderItems RoomServiceOrderItem[]
  roomServiceOrders     RoomServiceOrder[]
  rooms                 Room[]
  shifts                Shift[]
  smartAlerts           SmartAlert[]
  users                 User[]
  workflowRules         WorkflowRule[]

  @@map("tenants")
}

model User {
  id                         String              @id @default(uuid())
  tenantId                   String
  email                      String
  passwordHash               String
  firstName                  String
  lastName                   String
  phone                      String?
  role                       String
  permissions                Json?
  isActive                   Boolean             @default(true)
  lastLoginAt                DateTime?
  createdAt                  DateTime            @default(now())
  updatedAt                  DateTime            @updatedAt
  resolvedAlerts             Alert[]
  audits                     Audit[]
  createdFolios              Folio[]             @relation("FolioCreator")
  assignedGroupBookings      GroupBooking[]      @relation("AssignedGroupBookings")
  createdGroupBookings       GroupBooking[]
  assignedRequests           GuestRequest[]      @relation("AssignedRequests")
  createdRequests            GuestRequest[]      @relation("RequestCreator")
  assignedHousekeepingTasks  HousekeepingTask[]  @relation("AssignedHousekeepingTasks")
  completedHousekeepingTasks HousekeepingTask[]  @relation("CompletedHousekeepingTasks")
  createdItems               LostItem[]          @relation("ItemCreator")
  foundItems                 LostItem[]          @relation("FoundItems")
  assignedMaintenanceTickets MaintenanceTicket[] @relation("AssignedMaintenanceTickets")
  reportedMaintenanceTickets MaintenanceTicket[] @relation("ReportedMaintenanceTickets")
  resolvedMaintenanceTickets MaintenanceTicket[] @relation("ResolvedMaintenanceTickets")
  NightAudit                 NightAudit[]
  payments                   Payment[]
  checkedInReservations      Reservation[]       @relation("CheckInStaff")
  checkedOutReservations     Reservation[]       @relation("CheckOutStaff")
  createdReservations        Reservation[]       @relation("ReservationCreator")
  assignedOrders             RoomServiceOrder[]  @relation("AssignedOrders")
  createdOrders              RoomServiceOrder[]  @relation("OrderCreator")
  deliveredOrders            RoomServiceOrder[]  @relation("DeliveryStaff")
  shifts                     Shift[]
  createdSmartAlerts         SmartAlert[]
  resolvedSmartAlerts        SmartAlert[]        @relation("AlertResolver")
  tenant                     Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  createdWorkflowRules       WorkflowRule[]

  @@unique([tenantId, email])
  @@index([tenantId, role])
  @@map("users")
}

model Room {
  id                 String              @id @default(uuid())
  tenantId           String
  roomNumber         String
  roomType           String
  floor              Int?
  status             String              @default("available")
  maxOccupancy       Int
  amenities          Json?
  ratePlanId         String?
  createdAt          DateTime            @default(now())
  updatedAt          DateTime            @updatedAt
  categoryId         String?
  description        String?
  lastLogAt          DateTime?
  lastLogSummary     String?
  lastLogType        String?
  lastLogUserName    String?
  customRate         Decimal?            @db.Decimal(10, 2)
  folios             Folio[]
  housekeepingTasks  HousekeepingTask[]
  iotEvents          IoTEvent[]
  iotSensors         IoTSensor[]
  maintenanceTickets MaintenanceTicket[]
  reservations       Reservation[]
  roomLogs           RoomLog[]
  category           RoomCategory?       @relation(fields: [categoryId], references: [id])
  ratePlan           RatePlan?           @relation(fields: [ratePlanId], references: [id])
  tenant             Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@unique([tenantId, roomNumber])
  @@index([tenantId, status])
  @@index([tenantId, categoryId])
  @@map("rooms")
}

model RatePlan {
  id            String        @id @default(uuid())
  tenantId      String
  name          String
  description   String?
  baseRate      Decimal       @db.Decimal(10, 2)
  currency      String        @default("NGN")
  seasonalRules Json?
  isActive      Boolean       @default(true)
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt
  categoryId    String?
  category      RoomCategory? @relation(fields: [categoryId], references: [id])
  tenant        Tenant        @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  rooms         Room[]

  @@unique([tenantId, name])
  @@map("rate_plans")
}

model RoomCategory {
  id          String     @id @default(uuid())
  tenantId    String
  name        String
  description String?
  color       String?
  totalRooms  Int?       @default(0)
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt
  ratePlans   RatePlan[]
  tenant      Tenant     @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  rooms       Room[]

  @@unique([tenantId, name])
  @@index([tenantId])
  @@map("room_categories")
}

model Reservation {
  id                String           @id @default(uuid())
  tenantId          String
  roomId            String
  guestId           String?
  groupBookingId    String?
  reservationNumber String           @unique
  guestName         String
  guestEmail        String?
  guestPhone        String?
  guestIdNumber     String?
  checkInDate       DateTime
  checkOutDate      DateTime
  adults            Int              @default(1)
  children          Int              @default(0)
  status            String           @default("confirmed")
  source            String           @default("manual")
  rate              Decimal          @db.Decimal(10, 2)
  depositAmount     Decimal?         @db.Decimal(10, 2)
  depositStatus     String?
  depositRequired   Boolean          @default(true)
  specialRequests   String?
  createdAt         DateTime         @default(now())
  updatedAt         DateTime         @updatedAt
  checkedInAt       DateTime?
  checkedOutAt      DateTime?
  checkedInBy       String?
  checkedOutBy      String?
  createdBy         String
  depositPayments   DepositPayment[]
  folios            Folio[]
  checkInStaff      User?            @relation("CheckInStaff", fields: [checkedInBy], references: [id])
  checkOutStaff     User?            @relation("CheckOutStaff", fields: [checkedOutBy], references: [id])
  creator           User             @relation("ReservationCreator", fields: [createdBy], references: [id])
  groupBooking      GroupBooking?    @relation(fields: [groupBookingId], references: [id])
  guest             Guest?           @relation(fields: [guestId], references: [id])
  room              Room             @relation(fields: [roomId], references: [id])
  tenant            Tenant           @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId, status])
  @@index([tenantId, checkInDate, checkOutDate])
  @@index([tenantId, guestId])
  @@index([tenantId, groupBookingId])
  @@index([reservationNumber])
  @@map("reservations")
}

model RoomLog {
  id        String   @id @default(uuid())
  tenantId  String
  roomId    String
  type      String
  summary   String
  details   String?
  metadata  Json?
  userId    String?
  userName  String?
  createdAt DateTime @default(now())
  room      Room     @relation(fields: [roomId], references: [id])
  tenant    Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId, roomId])
  @@index([tenantId, type])
  @@map("room_logs")
}

model NightAudit {
  id            String   @id @default(uuid())
  tenantId      String
  auditDate     DateTime
  auditDateTime DateTime
  performedBy   String?
  status        String   @default("pending")
  discrepancies Json?
  summary       Json?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  performer     User?    @relation(fields: [performedBy], references: [id])
  tenant        Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId, auditDate])
  @@index([tenantId, status])
  @@map("night_audits")
}

model AccountabilityReport {
  id           String   @id @default(uuid())
  tenantId     String
  generatedBy  String
  lastReportAt DateTime
  flaggedCount Int      @default(0)
  noLogCount   Int      @default(0)
  staleCount   Int      @default(0)
  staleRooms   Json?
  createdAt    DateTime @default(now())
  tenant       Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId, lastReportAt])
  @@map("accountability_reports")
}

model Folio {
  id            String        @id @default(uuid())
  tenantId      String
  reservationId String?
  roomId        String
  guestName     String
  status        String        @default("open")
  totalCharges  Decimal       @default(0) @db.Decimal(10, 2)
  totalPayments Decimal       @default(0) @db.Decimal(10, 2)
  balance       Decimal       @default(0) @db.Decimal(10, 2)
  currency      String        @default("NGN")
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt
  closedAt      DateTime?
  closedBy      String?
  createdBy     String
  charges       FolioCharge[]
  creator       User          @relation("FolioCreator", fields: [createdBy], references: [id])
  reservation   Reservation?  @relation(fields: [reservationId], references: [id])
  room          Room          @relation(fields: [roomId], references: [id])
  tenant        Tenant        @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  payments      Payment[]

  @@index([tenantId, status])
  @@index([tenantId, roomId])
  @@map("folios")
}

model FolioCharge {
  id          String   @id @default(uuid())
  folioId     String
  description String
  category    String
  amount      Decimal  @db.Decimal(10, 2)
  quantity    Int      @default(1)
  total       Decimal  @db.Decimal(10, 2)
  taxRate     Decimal? @db.Decimal(5, 2)
  taxAmount   Decimal? @db.Decimal(10, 2)
  createdAt   DateTime @default(now())
  folio       Folio    @relation(fields: [folioId], references: [id], onDelete: Cascade)

  @@index([folioId])
  @@map("folio_charges")
}

model Payment {
  id                   String    @id @default(uuid())
  tenantId             String
  folioId              String
  amount               Decimal   @db.Decimal(10, 2)
  method               String
  reference            String?   @unique
  status               String    @default("pending")
  currency             String    @default("NGN")
  paymentGateway       String?
  gatewayTransactionId String?
  reconciled           Boolean   @default(false)
  reconciledAt         DateTime?
  reconciledBy         String?
  notes                String?
  createdAt            DateTime  @default(now())
  updatedAt            DateTime  @updatedAt
  userId               String
  folio                Folio     @relation(fields: [folioId], references: [id])
  tenant               Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  user                 User      @relation(fields: [userId], references: [id])

  @@index([tenantId, status])
  @@index([tenantId, reconciled])
  @@index([folioId])
  @@index([reference])
  @@map("payments")
}

model HousekeepingTask {
  id             String    @id @default(uuid())
  tenantId       String
  roomId         String
  taskType       String
  status         String    @default("pending")
  assignedTo     String?
  completedBy    String?
  completedAt    DateTime?
  photos         Json?
  checklist      Json?
  notes          String?
  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt
  assignedStaff  User?     @relation("AssignedHousekeepingTasks", fields: [assignedTo], references: [id])
  completedStaff User?     @relation("CompletedHousekeepingTasks", fields: [completedBy], references: [id])
  room           Room      @relation(fields: [roomId], references: [id])
  tenant         Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId, status])
  @@index([tenantId, roomId])
  @@map("housekeeping_tasks")
}

model MaintenanceTicket {
  id            String    @id @default(uuid())
  tenantId      String
  roomId        String?
  title         String
  description   String
  priority      String    @default("medium")
  status        String    @default("open")
  assignedTo    String?
  reportedBy    String
  resolvedBy    String?
  resolvedAt    DateTime?
  photos        Json?
  notes         String?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  assignedStaff User?     @relation("AssignedMaintenanceTickets", fields: [assignedTo], references: [id])
  reporter      User      @relation("ReportedMaintenanceTickets", fields: [reportedBy], references: [id])
  resolver      User?     @relation("ResolvedMaintenanceTickets", fields: [resolvedBy], references: [id])
  room          Room?     @relation(fields: [roomId], references: [id])
  tenant        Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId, status])
  @@index([tenantId, priority])
  @@map("maintenance_tickets")
}

model Shift {
  id           String    @id @default(uuid())
  tenantId     String
  userId       String
  startTime    DateTime
  endTime      DateTime?
  shiftType    String
  cashFloat    Decimal?  @db.Decimal(10, 2)
  cashReceived Decimal?  @db.Decimal(10, 2)
  cashCounted  Decimal?  @db.Decimal(10, 2)
  variance     Decimal?  @db.Decimal(10, 2)
  status       String    @default("open")
  notes        String?
  closedAt     DateTime?
  closedBy     String?
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt
  tenant       Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  user         User      @relation(fields: [userId], references: [id])

  @@index([tenantId, userId])
  @@index([tenantId, status])
  @@map("shifts")
}

model Audit {
  id          String   @id @default(uuid())
  tenantId    String
  userId      String?
  action      String
  entityType  String
  entityId    String
  beforeState Json?
  afterState  Json?
  metadata    Json?
  timestamp   DateTime @default(now())
  tenant      Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  user        User?    @relation(fields: [userId], references: [id])

  @@index([tenantId, action])
  @@index([tenantId, entityType, entityId])
  @@index([tenantId, timestamp])
  @@map("audits")
}

model Alert {
  id         String    @id @default(uuid())
  tenantId   String
  alertType  String
  severity   String    @default("medium")
  title      String
  message    String
  metadata   Json?
  status     String    @default("open")
  resolvedBy String?
  resolvedAt DateTime?
  createdAt  DateTime  @default(now())
  resolver   User?     @relation(fields: [resolvedBy], references: [id])
  tenant     Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId, status])
  @@index([tenantId, alertType])
  @@index([tenantId, severity])
  @@map("alerts")
}

model IoTGateway {
  id        String      @id @default(uuid())
  tenantId  String
  gatewayId String      @unique
  name      String
  location  String?
  status    String      @default("active")
  lastSeen  DateTime?
  config    Json?
  createdAt DateTime    @default(now())
  updatedAt DateTime    @updatedAt
  tenant    Tenant      @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  sensors   IoTSensor[]

  @@unique([tenantId, gatewayId])
  @@map("iot_gateways")
}

model IoTSensor {
  id          String     @id @default(uuid())
  gatewayId   String
  sensorId    String
  roomId      String?
  sensorType  String
  status      String     @default("active")
  lastEventAt DateTime?
  config      Json?
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt
  gateway     IoTGateway @relation(fields: [gatewayId], references: [id], onDelete: Cascade)
  room        Room?      @relation(fields: [roomId], references: [id])

  @@unique([gatewayId, sensorId])
  @@index([roomId])
  @@map("iot_sensors")
}

model IoTEvent {
  id        String   @id @default(uuid())
  tenantId  String
  gatewayId String
  sensorId  String
  roomId    String?
  eventType String
  timestamp DateTime
  metadata  Json?
  createdAt DateTime @default(now())
  room      Room?    @relation(fields: [roomId], references: [id])
  tenant    Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId, roomId])
  @@index([tenantId, timestamp])
  @@index([sensorId])
  @@map("iot_events")
}

model DepositPolicy {
  id                    String   @id @default(uuid())
  tenantId              String
  name                  String
  description           String?
  isActive              Boolean  @default(true)
  appliesToAllRooms     Boolean  @default(true)
  roomCategoryIds       String[]
  ratePlanIds           String[]
  depositType           String
  depositValue          Decimal  @db.Decimal(10, 2)
  maxDepositAmount      Decimal? @db.Decimal(10, 2)
  minDepositAmount      Decimal? @db.Decimal(10, 2)
  dueDaysBeforeCheckIn  Int
  refundableAfterDays   Int?
  cancellationFee       Decimal? @db.Decimal(5, 2)
  requiresForWeekends   Boolean  @default(false)
  requiresForHolidays   Boolean  @default(false)
  requiresForPeakSeason Boolean  @default(false)
  createdAt             DateTime @default(now())
  updatedAt             DateTime @updatedAt
  tenant                Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@unique([tenantId, name])
  @@index([tenantId, isActive])
  @@map("deposit_policies")
}

model DepositPayment {
  id                   String      @id @default(uuid())
  tenantId             String
  reservationId        String
  amount               Decimal     @db.Decimal(10, 2)
  currency             String      @default("NGN")
  method               String
  reference            String?     @unique
  status               String      @default("pending")
  paymentGateway       String?
  gatewayTransactionId String?
  notes                String?
  paidAt               DateTime?
  processedBy          String?
  refundedAt           DateTime?
  refundedBy           String?
  refundAmount         Decimal?    @db.Decimal(10, 2)
  refundReason         String?
  createdAt            DateTime    @default(now())
  updatedAt            DateTime    @updatedAt
  reservation          Reservation @relation(fields: [reservationId], references: [id], onDelete: Cascade)
  tenant               Tenant      @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId, status])
  @@index([tenantId, reservationId])
  @@index([reference])
  @@map("deposit_payments")
}

model GroupBooking {
  id                  String                        @id @default(uuid())
  tenantId            String
  groupBookingNumber  String                        @unique
  groupName           String
  groupType           String
  contactPerson       String
  contactEmail        String
  contactPhone        String
  expectedGuests      Int
  confirmedGuests     Int                           @default(0)
  checkInDate         DateTime
  checkOutDate        DateTime
  totalRooms          Int
  totalRevenue        Decimal                       @default(0) @db.Decimal(12, 2)
  depositAmount       Decimal?                      @db.Decimal(10, 2)
  depositPaid         Boolean                       @default(false)
  status              String                        @default("pending")
  bookingProgress     String                        @default("initial_contact")
  specialRequests     String?
  dietaryRequirements String?
  setupRequirements   String?
  assignedTo          String?
  createdBy           String
  createdAt           DateTime                      @default(now())
  updatedAt           DateTime                      @updatedAt
  hallReservations    GroupBookingHallReservation[]
  assignedStaff       User?                         @relation("AssignedGroupBookings", fields: [assignedTo], references: [id])
  creator             User                          @relation(fields: [createdBy], references: [id])
  tenant              Tenant                        @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  reservations        Reservation[]
  roomBlocks          RoomBlock[]

  @@index([tenantId, status])
  @@index([tenantId, checkInDate, checkOutDate])
  @@index([groupBookingNumber])
  @@map("group_bookings")
}

model RoomBlock {
  id              String       @id @default(uuid())
  tenantId        String
  groupBookingId  String
  roomCategoryId  String
  roomType        String
  totalRooms      Int
  allocatedRooms  Int          @default(0)
  availableRooms  Int
  negotiatedRate  Decimal?     @db.Decimal(10, 2)
  discountPercent Decimal?     @db.Decimal(5, 2)
  checkInDate     DateTime
  checkOutDate    DateTime
  createdAt       DateTime     @default(now())
  updatedAt       DateTime     @updatedAt
  groupBooking    GroupBooking @relation(fields: [groupBookingId], references: [id], onDelete: Cascade)
  tenant          Tenant       @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId, groupBookingId])
  @@index([tenantId, roomCategoryId])
  @@map("room_blocks")
}

model MeetingHall {
  id               String                        @id @default(uuid())
  tenantId         String
  name             String
  description      String?
  capacity         Int
  location         String?
  amenities        Json?
  isActive         Boolean                       @default(true)
  createdAt        DateTime                      @default(now())
  updatedAt        DateTime                      @updatedAt
  hallReservations GroupBookingHallReservation[]
  tenant           Tenant                        @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@unique([tenantId, name])
  @@index([tenantId, isActive])
  @@map("meeting_halls")
}

model GroupBookingHallReservation {
  id             String       @id @default(uuid())
  tenantId       String
  groupBookingId String
  hallId         String
  eventName      String?
  purpose        String?
  setupType      String?
  attendeeCount  Int?
  startDateTime  DateTime
  endDateTime    DateTime
  cateringNotes  String?
  avRequirements String?
  status         String       @default("tentative")
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @updatedAt
  groupBooking   GroupBooking @relation(fields: [groupBookingId], references: [id], onDelete: Cascade)
  hall           MeetingHall  @relation(fields: [hallId], references: [id])
  tenant         Tenant       @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId, hallId])
  @@index([tenantId, groupBookingId])
  @@index([tenantId, status])
  @@map("group_booking_halls")
}

model OverbookingSetting {
  id                       String     @id @default(uuid())
  tenantId                 String
  roomCategoryId           String?
  roomType                 String?
  maxOverbookingPercent    Decimal    @default(10) @db.Decimal(5, 2)
  maxOverbookingCount      Int?
  alertThresholdPercent    Decimal    @default(5) @db.Decimal(5, 2)
  criticalThresholdPercent Decimal    @default(8) @db.Decimal(5, 2)
  allowOverbooking         Boolean    @default(false)
  requireManagerApproval   Boolean    @default(true)
  blackoutDates            DateTime[]
  createdAt                DateTime   @default(now())
  updatedAt                DateTime   @updatedAt
  tenant                   Tenant     @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@unique([tenantId, roomCategoryId, roomType])
  @@index([tenantId])
  @@map("overbooking_settings")
}

model OverbookingAlert {
  id                 String    @id @default(uuid())
  tenantId           String
  roomCategoryId     String
  roomType           String
  date               DateTime
  totalRooms         Int
  bookedRooms        Int
  overbookedRooms    Int
  overbookingPercent Decimal   @db.Decimal(5, 2)
  status             String    @default("active")
  resolvedAt         DateTime?
  resolvedBy         String?
  resolutionNotes    String?
  createdAt          DateTime  @default(now())
  updatedAt          DateTime  @updatedAt
  tenant             Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId, date])
  @@index([tenantId, status])
  @@map("overbooking_alerts")
}

model GuestRequest {
  id                  String                @id @default(uuid())
  tenantId            String
  guestId             String?
  reservationId       String?
  roomId              String?
  requestType         String
  priority            String                @default("normal")
  title               String
  description         String
  status              String                @default("pending")
  guestName           String?
  guestPhone          String?
  guestEmail          String?
  roomNumber          String?
  assignedTo          String?
  department          String?
  estimatedCompletion DateTime?
  actualCompletion    DateTime?
  guestNotified       Boolean               @default(false)
  lastGuestUpdate     DateTime?
  source              String                @default("manual")
  tags                String[]
  createdBy           String
  createdAt           DateTime              @default(now())
  updatedAt           DateTime              @updatedAt
  messages            GuestRequestMessage[]
  updates             GuestRequestUpdate[]
  assignedStaff       User?                 @relation("AssignedRequests", fields: [assignedTo], references: [id])
  creator             User                  @relation("RequestCreator", fields: [createdBy], references: [id])
  guest               Guest?                @relation(fields: [guestId], references: [id])
  tenant              Tenant                @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId, status])
  @@index([tenantId, priority])
  @@index([tenantId, requestType])
  @@index([tenantId, guestId])
  @@index([tenantId, assignedTo])
  @@map("guest_requests")
}

model GuestRequestMessage {
  id               String       @id @default(uuid())
  tenantId         String
  guestRequestId   String
  message          String
  messageType      String       @default("note")
  isFromGuest      Boolean      @default(false)
  isVisibleToGuest Boolean      @default(false)
  createdBy        String?
  createdAt        DateTime     @default(now())
  guestRequest     GuestRequest @relation(fields: [guestRequestId], references: [id], onDelete: Cascade)

  @@index([tenantId, guestRequestId])
  @@map("guest_request_messages")
}

model GuestRequestUpdate {
  id             String       @id @default(uuid())
  tenantId       String
  guestRequestId String
  previousStatus String
  newStatus      String
  updateType     String
  notes          String?
  performedBy    String
  createdAt      DateTime     @default(now())
  guestRequest   GuestRequest @relation(fields: [guestRequestId], references: [id], onDelete: Cascade)

  @@index([tenantId, guestRequestId])
  @@map("guest_request_updates")
}

model LostItem {
  id                String    @id @default(uuid())
  tenantId          String
  itemNumber        String    @unique
  itemName          String
  description       String
  category          String
  color             String?
  brand             String?
  serialNumber      String?
  value             Decimal?  @db.Decimal(10, 2)
  foundLocation     String
  foundBy           String?
  foundAt           DateTime
  circumstances     String?
  reportedByGuestId String?
  reportedByName    String?
  reportedByPhone   String?
  reportedByEmail   String?
  reportedByRoom    String?
  reportedAt        DateTime?
  status            String    @default("unclaimed")
  storageLocation   String?
  storageNotes      String?
  claimedBy         String?
  claimedAt         DateTime?
  claimMethod       String?
  returnedTo        String?
  returnMethod      String?
  disposedAt        DateTime?
  disposedBy        String?
  disposalMethod    String?
  createdBy         String
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt
  creator           User      @relation("ItemCreator", fields: [createdBy], references: [id])
  foundStaff        User?     @relation("FoundItems", fields: [foundBy], references: [id])
  reportedGuest     Guest?    @relation(fields: [reportedByGuestId], references: [id])
  tenant            Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@unique([tenantId, itemNumber])
  @@index([tenantId, status])
  @@index([tenantId, category])
  @@index([tenantId, foundAt])
  @@map("lost_items")
}

model MenuCategory {
  id           String     @id @default(uuid())
  tenantId     String
  name         String
  description  String?
  displayOrder Int        @default(0)
  isActive     Boolean    @default(true)
  imageUrl     String?
  createdAt    DateTime   @default(now())
  updatedAt    DateTime   @updatedAt
  tenant       Tenant     @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  items        MenuItem[]

  @@unique([tenantId, name])
  @@index([tenantId, isActive])
  @@map("menu_categories")
}

model MenuItem {
  id              String                 @id @default(uuid())
  tenantId        String
  categoryId      String
  name            String
  description     String?
  price           Decimal                @db.Decimal(8, 2)
  imageUrl        String?
  isActive        Boolean                @default(true)
  isVegetarian    Boolean                @default(false)
  isVegan         Boolean                @default(false)
  isGlutenFree    Boolean                @default(false)
  containsNuts    Boolean                @default(false)
  spiceLevel      String                 @default("mild")
  preparationTime Int?
  allergens       String[]
  createdAt       DateTime               @default(now())
  updatedAt       DateTime               @updatedAt
  category        MenuCategory           @relation(fields: [categoryId], references: [id], onDelete: Cascade)
  tenant          Tenant                 @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  orderItems      RoomServiceOrderItem[]

  @@index([tenantId, isActive])
  @@index([tenantId, categoryId])
  @@map("menu_items")
}

model RoomServiceOrder {
  id                  String                 @id @default(uuid())
  tenantId            String
  orderNumber         String                 @unique
  guestId             String?
  guestName           String
  roomNumber          String
  guestPhone          String?
  status              String                 @default("pending")
  orderType           String                 @default("room_service")
  specialInstructions String?
  estimatedDelivery   DateTime?
  subtotal            Decimal                @default(0) @db.Decimal(8, 2)
  taxAmount           Decimal                @default(0) @db.Decimal(8, 2)
  serviceCharge       Decimal                @default(0) @db.Decimal(8, 2)
  totalAmount         Decimal                @default(0) @db.Decimal(8, 2)
  deliveredAt         DateTime?
  deliveredBy         String?
  deliveryNotes       String?
  assignedTo          String?
  preparedAt          DateTime?
  requestedAt         DateTime               @default(now())
  confirmedAt         DateTime?
  createdBy           String?
  updatedAt           DateTime               @updatedAt
  items               RoomServiceOrderItem[]
  assignedStaff       User?                  @relation("AssignedOrders", fields: [assignedTo], references: [id])
  creator             User?                  @relation("OrderCreator", fields: [createdBy], references: [id])
  deliveryStaff       User?                  @relation("DeliveryStaff", fields: [deliveredBy], references: [id])
  guest               Guest?                 @relation(fields: [guestId], references: [id])
  tenant              Tenant                 @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@unique([tenantId, orderNumber])
  @@index([tenantId, status])
  @@index([tenantId, requestedAt])
  @@index([tenantId, roomNumber])
  @@map("room_service_orders")
}

model RoomServiceOrderItem {
  id              String           @id @default(uuid())
  tenantId        String
  orderId         String
  menuItemId      String
  quantity        Int
  unitPrice       Decimal          @db.Decimal(8, 2)
  totalPrice      Decimal          @db.Decimal(8, 2)
  specialRequests String?
  status          String           @default("pending")
  preparedAt      DateTime?
  menuItem        MenuItem         @relation(fields: [menuItemId], references: [id], onDelete: Cascade)
  order           RoomServiceOrder @relation(fields: [orderId], references: [id], onDelete: Cascade)
  tenant          Tenant           @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId, orderId])
  @@index([tenantId, status])
  @@map("room_service_order_items")
}

model AnalyticsMetric {
  id             String   @id @default(uuid())
  tenantId       String
  metricKey      String
  metricName     String
  category       String
  value          Decimal? @db.Decimal(12, 2)
  previousValue  Decimal? @db.Decimal(12, 2)
  changePercent  Decimal? @db.Decimal(8, 2)
  targetValue    Decimal? @db.Decimal(12, 2)
  status         String   @default("normal")
  periodType     String   @default("daily")
  periodStart    DateTime
  periodEnd      DateTime
  metadata       Json?
  lastCalculated DateTime @default(now())
  tenant         Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@unique([tenantId, metricKey, periodType, periodStart])
  @@index([tenantId, category])
  @@index([tenantId, periodType, periodStart])
  @@map("analytics_metrics")
}

model PredictiveModel {
  id               String    @id @default(uuid())
  tenantId         String
  modelType        String
  modelName        String
  version          String
  modelData        Json?
  accuracy         Decimal?  @db.Decimal(5, 2)
  lastTrained      DateTime?
  trainingDataSize Int?
  isActive         Boolean   @default(true)
  confidence       Decimal?  @db.Decimal(5, 2)
  createdAt        DateTime  @default(now())
  updatedAt        DateTime  @updatedAt
  tenant           Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId, modelType])
  @@index([tenantId, isActive])
  @@map("predictive_models")
}

model WorkflowRule {
  id             String    @id @default(uuid())
  tenantId       String
  ruleName       String
  ruleType       String
  triggerEvent   String
  conditions     Json?
  actions        Json?
  priority       Int       @default(0)
  isActive       Boolean   @default(true)
  lastExecuted   DateTime?
  executionCount Int       @default(0)
  createdBy      String
  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt
  creator        User      @relation(fields: [createdBy], references: [id])
  tenant         Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId, ruleType])
  @@index([tenantId, triggerEvent])
  @@index([tenantId, isActive])
  @@map("workflow_rules")
}

model SmartAlert {
  id                  String    @id @default(uuid())
  tenantId            String
  alertType           String
  severity            String    @default("info")
  title               String
  message             String
  description         String?
  threshold           Json?
  conditions          Json?
  notifyUsers         String[]
  notifyRoles         String[]
  channels            String[]  @default(["dashboard"])
  status              String    @default("active")
  triggeredAt         DateTime?
  resolvedAt          DateTime?
  resolvedBy          String?
  autoResolve         Boolean   @default(false)
  resolveAfterMinutes Int?
  createdBy           String
  createdAt           DateTime  @default(now())
  updatedAt           DateTime  @updatedAt
  creator             User      @relation(fields: [createdBy], references: [id])
  resolver            User?     @relation("AlertResolver", fields: [resolvedBy], references: [id])
  tenant              Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId, alertType])
  @@index([tenantId, status])
  @@index([tenantId, severity])
  @@map("smart_alerts")
}

model GuestBehavior {
  id               String   @id @default(uuid())
  tenantId         String
  guestId          String?
  behaviorType     String
  behaviorKey      String
  behaviorValue    String
  confidence       Decimal  @default(1) @db.Decimal(5, 2)
  firstObserved    DateTime
  lastObserved     DateTime
  observationCount Int      @default(1)
  contextData      Json?
  guest            Guest?   @relation(fields: [guestId], references: [id])
  tenant           Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId, behaviorType])
  @@index([tenantId, guestId])
  @@index([tenantId, behaviorKey])
  @@map("guest_behaviors")
}

model InventoryAnalytics {
  id                   String    @id @default(uuid())
  tenantId             String
  itemType             String
  itemId               String
  dailyUsage           Decimal   @default(0) @db.Decimal(8, 2)
  weeklyUsage          Decimal   @default(0) @db.Decimal(8, 2)
  monthlyUsage         Decimal   @default(0) @db.Decimal(8, 2)
  predictedDailyUsage  Decimal?  @db.Decimal(8, 2)
  predictedWeeklyUsage Decimal?  @db.Decimal(8, 2)
  reorderPoint         Decimal?  @db.Decimal(8, 2)
  lowStockAlert        Boolean   @default(false)
  overStockAlert       Boolean   @default(false)
  lastCalculated       DateTime  @default(now())
  nextReorderDate      DateTime?
  tenant               Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@unique([tenantId, itemType, itemId])
  @@index([tenantId, itemType])
  @@index([tenantId, lowStockAlert])
  @@map("inventory_analytics")
}

model Guest {
  id                  String               @id @default(uuid())
  tenantId            String
  name                String
  email               String?
  phone               String?
  idNumber            String?
  dateOfBirth         DateTime?
  nationality         String?
  address             String?
  city                String?
  state               String?
  country             String?
  postalCode          String?
  loyaltyTier         String               @default("bronze")
  loyaltyPoints       Int                  @default(0)
  totalStays          Int                  @default(0)
  totalNights         Int                  @default(0)
  totalSpent          Decimal              @default(0) @db.Decimal(12, 2)
  preferredRoomType   String?
  preferredFloor      Int?
  smokingPreference   Boolean              @default(false)
  bedPreference       String?
  pillowPreference    String?
  dietaryRestrictions Json?
  allergies           Json?
  specialRequests     String?
  isVIP               Boolean              @default(false)
  isBanned            Boolean              @default(false)
  bannedReason        String?
  bannedAt            DateTime?
  marketingOptIn      Boolean              @default(true)
  emailOptIn          Boolean              @default(true)
  smsOptIn            Boolean              @default(true)
  firstStayDate       DateTime?
  lastStayDate        DateTime?
  createdAt           DateTime             @default(now())
  updatedAt           DateTime             @updatedAt
  activityLogs        GuestActivityLog[]
  guestBehaviors      GuestBehavior[]
  notes               GuestNote[]
  guestRequests       GuestRequest[]
  tenant              Tenant               @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  lostItems           LostItem[]
  loyaltyTransactions LoyaltyTransaction[]
  reservations        Reservation[]
  roomServiceOrders   RoomServiceOrder[]
  guestAccounts       GuestAccount[]

  @@unique([tenantId, email])
  @@unique([tenantId, phone])
  @@index([tenantId, loyaltyTier])
  @@index([tenantId, isVIP])
  @@index([tenantId, email])
  @@index([tenantId, phone])
  @@map("guests")
}

model GuestActivityLog {
  id           String   @id @default(uuid())
  tenantId     String
  guestId      String
  activityType String
  title        String
  description  String?
  metadata     Json?
  performedBy  String?
  createdAt    DateTime @default(now())
  guest        Guest    @relation(fields: [guestId], references: [id], onDelete: Cascade)

  @@index([tenantId, guestId, createdAt])
  @@index([tenantId, activityType])
  @@map("guest_activity_logs")
}

model GuestNote {
  id          String   @id @default(uuid())
  tenantId    String
  guestId     String
  noteType    String   @default("general")
  note        String
  isImportant Boolean  @default(false)
  isPinned    Boolean  @default(false)
  createdBy   String
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  guest       Guest    @relation(fields: [guestId], references: [id], onDelete: Cascade)

  @@index([tenantId, guestId, createdAt])
  @@index([tenantId, isImportant])
  @@index([tenantId, isPinned])
  @@map("guest_notes")
}

model LoyaltyProgram {
  id                   String   @id @default(uuid())
  tenantId             String   @unique
  isActive             Boolean  @default(true)
  programName          String   @default("InnSight Rewards")
  pointsPerNight       Int      @default(10)
  pointsPerCurrency    Decimal  @default(1) @db.Decimal(10, 2)
  silverThreshold      Int      @default(100)
  goldThreshold        Int      @default(500)
  platinumThreshold    Int      @default(1000)
  vipThreshold         Int      @default(5000)
  bronzeDiscount       Decimal  @default(0) @db.Decimal(5, 2)
  silverDiscount       Decimal  @default(5) @db.Decimal(5, 2)
  goldDiscount         Decimal  @default(10) @db.Decimal(5, 2)
  platinumDiscount     Decimal  @default(15) @db.Decimal(5, 2)
  vipDiscount          Decimal  @default(20) @db.Decimal(5, 2)
  pointsRedemptionRate Decimal  @default(100) @db.Decimal(10, 2)
  minRedemptionPoints  Int      @default(500)
  pointsExpiryMonths   Int?
  createdAt            DateTime @default(now())
  updatedAt            DateTime @updatedAt
  tenant               Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@map("loyalty_programs")
}

model LoyaltyTransaction {
  id              String   @id @default(uuid())
  tenantId        String
  guestId         String
  transactionType String
  points          Int
  balanceBefore   Int
  balanceAfter    Int
  description     String
  reservationId   String?
  metadata        Json?
  createdBy       String?
  createdAt       DateTime @default(now())
  guest           Guest    @relation(fields: [guestId], references: [id], onDelete: Cascade)

  @@index([tenantId, guestId, createdAt])
  @@index([tenantId, transactionType])
  @@map("loyalty_transactions")
}

model GuestAccount {
  id               String    @id @default(uuid())
  tenantId         String
  guestId          String?
  email            String
  phone            String?
  passwordHash     String
  isEmailVerified  Boolean   @default(false)
  isPhoneVerified  Boolean   @default(false)
  marketingOptIn   Boolean   @default(true)
  lastLoginAt      DateTime?
  createdAt        DateTime  @default(now())
  updatedAt        DateTime  @updatedAt
  tenant           Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  guest            Guest?    @relation(fields: [guestId], references: [id], onDelete: SetNull)

  @@unique([tenantId, email])
  @@unique([tenantId, phone])
  @@index([tenantId, guestId])
  @@map("guest_accounts")
}
